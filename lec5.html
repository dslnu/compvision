<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <title>Computer Vision – Filters and image derivatives</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-2f366650f320edcfcf53d73c80250a32.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Filters and image derivatives</h1>

<div class="quarto-title-authors">
</div>

</section>
<section>
<section id="sec-blur_filters" class="title-slide slide level1 center">
<h1>Blur Filters</h1>

</section>
<section id="introduction" class="slide level2">
<h2>Introduction</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Blur filters</strong></p>
</div>
<div class="callout-content">
<p>Blur filters are low-pass filters</p>
<ul>
<li>remove the high spatial-frequency content</li>
<li>leave only the low-frequency spatial components.</li>
</ul>
<p>The result is an image that has lost details and that looks <strong>blurry</strong>.</p>
</div>
</div>
</div>
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Blur applications</strong></p>
</div>
<div class="callout-content">
<ul>
<li>it can be used to reduce noise</li>
<li>to reveal image structures at different scales</li>
<li>upsampling and downsampling images.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="blur-filters-1" class="slide level2">
<h2>Blur filters</h2>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-stop_256_noise_3-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-stop_256_noise_3-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/stop_256_noise_3.jpg">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stop_256_noise_3-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Original noisy image.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-stop_256_noise_3-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-stop_256_noise_3-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/stop_256_blur_3.jpg">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stop_256_noise_3-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Blurred image.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="blur-filters-2" class="slide level2">
<h2>Blur filters</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Implementation</strong></p>
</div>
<div class="callout-content">
<p>Blurring is implemented by computing local averages over small neighborhoods of input pixel values. This can be done by:</p>
<ul>
<li>convolution (<strong>linear</strong>)</li>
<li>anisotropic diffusion (<strong>non-linear</strong>)</li>
<li>bilateral filtering (<strong>non-linear</strong>)</li>
</ul>
</div>
</div>
</div>
</section>
<section id="box-filter" class="slide level2">
<h2>Box Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Box filter - definition</strong></p>
</div>
<div class="callout-content">
<p>Let’s start with a very simple low-pass filter, the box filter. The box filter uses a box function as the convolution kernel. The box convolution kernel can be written as:</p>
<p><span class="math display">\[
\text{box}_{N,M} \left[n,m \right] =
\begin{cases}
    1       &amp; \quad \text{if } -N \leq n \leq N  \; \text{and} \;   -M \leq m \leq M\\
    0       &amp; \quad \text{otherwise.}
\end{cases}
\]</span></p>
<p>Filtering an input image, <span class="math inline">\(\ell_{\text{in}}\)</span>, with a box filter results in the following: <span class="math display">\[\begin{aligned}
\ell_{\text{out}} \left[n,m\right] &amp;=
\text{box}_{N,M} \left[n,m\right] \circ \ell_{\text{in}} \left[n,m\right]  \\
&amp;= \sum_{k,l} \ell_{\text{in}} \left[n-k,m-l \right] \text{box}_{N,M} \left[k,l \right] \\
&amp;= \sum_{k=-N}^N \sum_{l=-M}^M \ell_{\text{in}} \left[n-k,m-l \right]
\end{aligned}\]</span></p>
</div>
</div>
</div>
</section>
<section id="box-filter-1" class="slide level2">
<h2>Box Filter</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>The box filter with <span class="math inline">\(N=M=1\)</span> is:</p>
<p><img data-src="img/blur_filters/box.png" height="450"></p>
</div>
</div>
</div>
</section>
<section id="box-filter-2" class="slide level2">
<h2>Box Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Visual examples</strong></p>
</div>
<div class="callout-content">
<div id="fig-convExamps2" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-convExamps2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/convexamps.png">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-convExamps2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Fig (a) Input image. (b) Blurring with a square, (c) a horizontal, and (d) a vertical line. Each color channel is filtered independently.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="box-filter-3" class="slide level2">
<h2>Box Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Properties</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li><p>Low-pass: it attenuates the high spatial-frequency content of the input image.</p></li>
<li><p>2D box filter is separable and can be written as the convolution of two 1D kernels: <span class="math display">\[
\text{box}_{N,M} \left[n,m \right]  = \text{box}_{N,0} \circ \text{box}_{0,M}.
\]</span></p></li>
<li><p><strong>DC gain</strong>: the gain it has for a constant value input (i.e., the lowest possible input frequency). If the input signal is a constant, i.e., <span class="math inline">\(\ell[n,m] = a\)</span>, where <span class="math inline">\(a\)</span> is a real number, the result of convolving the image with the box filter <span class="math inline">\(h_{N,M}\)</span> is also a constant:</p></li>
</ol>
<p><span class="math display">\[
\ell_{\text{out}} \left[n,m\right] = \sum_{k,l} a \text{box}_{N,M} \left[k,l \right] = a \sum_{k,l} \text{box}_{N,M} \left[k,l \right]  = a (2N+1)(2M+1)
\]</span></p>
</div>
</div>
</div>
</section>
<section id="box-filter-4" class="slide level2">
<h2>Box Filter</h2>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>Remember that the DC value of a signal is its mean value. DC is an old name derived from Direct Current.</p>
<p>In general, the DC gain of an arbitrary filter <span class="math inline">\(h [n,m]\)</span> is the sum of its kernel values:</p>
<p><span class="math display">\[
\text{DC gain} = \sum_{n,m} h [n,m]
\]</span> In the example of the box filter with <span class="math inline">\(N=1\)</span>, the DC gain is 3.</p>
<p>In the frequency domain, the DC gain of a filter refers to its gain at a frequency of 0, represented by the value <span class="math inline">\(H[0,0]\)</span>. The value of <span class="math inline">\(\left| \text{Box}_1[0] \right|\)</span> is <span class="math inline">\(3\)</span>. The DC gain of a filter will change the mean value of the input signal.</p>
</div>
</div>
</div>
</section>
<section id="box-filter-5" class="slide level2">
<h2>Box Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Examples</strong></p>
</div>
<div class="callout-content">
<div class="columns">
<div class="column" style="width:50%;">
<div id="fig-boxfilter-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-boxfilter-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/boxfilter_1d.png">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxfilter-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: 1D Box Filter.
</figcaption>
</figure>
</div>
</div><div class="column" style="width:50%;">
<div id="fig-boxfilter-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-boxfilter-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/boxfilter_fourier.png">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxfilter-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Fourier transform of Box Filter.
</figcaption>
</figure>
</div>
</div></div>
<p>Fig (a) A one-dimensional (1D) box filter (<span class="math inline">\(\left[1,1,1\right]\)</span>), and (b) its Fourier transform over 20 samples. Note that the frequency gain is not monotonically decreasing with spatial frequency.</p>
</div>
</div>
</div>
</section>
<section id="box-filter-6" class="slide level2">
<h2>Box Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>DC gain: normalization</strong></p>
</div>
<div class="callout-content">
<ul>
<li>we generally want to have a DC gain of 1</li>
<li>the reason is that if we have an image with grayscale levels in the range of 0 to 256 and with an average around 128, we will want to preserve the same mean value in the output.</li>
<li>For this reason, in most applications, we will normalize the kernel values so that they sum 1.</li>
<li>In the case of the box filter, this means dividing the kernel values by <span class="math inline">\((2N+1)(2M+1)\)</span>.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="box-filter-7" class="slide level2">
<h2>Box Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Limitations</strong></p>
</div>
<div class="callout-content">
<ul>
<li><strong>The box filter is not a perfect blurring filter.</strong></li>
</ul>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/blur_filters/osci.png" height="200"></p>
<figcaption>Oscillating signal</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/blur_filters/kern.png" height="200"></p>
<figcaption>Convolved with <span class="math inline">\([1,1,1]\)</span></figcaption>
</figure>
</div>
</div>
</div>
</div>
<ul>
<li><strong>If you convolve two boxes, you get a triangle.</strong> For <span class="math inline">\(N=1, M=0\)</span>:</li>
</ul>
<p><span class="math display">\[
\text{box}_{1,0} \circ \text{box}_{1,0} = \left[1, 1, 1\right] \circ \left[1, 1, 1\right] = \left[1,2,3,2,1\right]
\]</span></p>
</div>
</div>
</div>
</section>
<section id="sec-spt_gaussian" class="slide level2">
<h2>Gaussian Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Definition</strong></p>
</div>
<div class="callout-content">
<p>The Gaussian distribution is defined in continuous variables. In one dimension:</p>
<p><span id="eq-gauss1dcont"><span class="math display">\[
g(x; \sigma) = \frac{1}{\sqrt{2 \pi \sigma^2}} \exp{ \left( -\frac{x^2}{2 \sigma^2} \right) }
\qquad(1)\]</span></span></p>
<p>and in two dimensions:</p>
<p><span id="eq-gauss2dcont"><span class="math display">\[
g(x,y; \sigma) = \frac{1}{2 \pi \sigma^2} \exp{ \left(-\frac{x^2 + y^2}{2 \sigma^2} \right) }
\qquad(2)\]</span></span></p>
<p>The parameter <span class="math inline">\(\sigma\)</span> adjusts the spatial extent of the Gaussian. The normalization constant is set so that the function integrates to 1. The Gaussian kernel is positive and symmetric (a zero-phase filter).</p>
</div>
</div>
</div>
</section>
<section id="gaussian-filter" class="slide level2 smaller">
<h2>Gaussian Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Discretization</strong></p>
</div>
<div class="callout-content">
<p>We only need to consider samples within three standard deviations <span class="math inline">\(x \in (-3\sigma, 3\sigma)\)</span>.</p>
<p>For a given <span class="math inline">\(\sigma\)</span>:</p>
<p><span id="eq-gauss2d"><span class="math display">\[
g \left[ n,m; \sigma \right] = \exp{ \left( -\frac{n^2 + m^2}{2 \sigma^2} \right) }
\qquad(3)\]</span></span></p>
</div>
</div>
</div>

<!-- We have removed the normalization constant as the sum of the discrete Gaussian will be different from the integral of the continuous function. So here we prefer to define the form in which the value at the origin is 1. In practice, we should normalize the discrete Gaussian by the sum of its values to make sure that the DC gain is 1. -->
<img data-src="img/blur_filters/gaus.png" style="width:90.0%" class="r-stretch quarto-figure-center"><p class="caption">1D Gaussian with <span class="math inline">\(\sigma=1\)</span> and its discretized version</p></section>
<section id="gaussian-filter-1" class="slide level2">
<h2>Gaussian Filter</h2>
<div id="fig-zebragaussian" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-zebragaussian-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-zebragaussian" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-zebragaussian-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-zebragaussian-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/gausian_zebra_c_2.jpg" data-ref-parent="fig-zebragaussian">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-zebragaussian-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Gaussian filter with <span class="math inline">\(\sigma=2\)</span>.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-zebragaussian" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-zebragaussian-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-zebragaussian-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/gausian_zebra_c_4.jpg" data-ref-parent="fig-zebragaussian">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-zebragaussian-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Gaussian filter with <span class="math inline">\(\sigma=4\)</span>.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-zebragaussian" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-zebragaussian-c" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-zebragaussian-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/gausian_zebra_c_8.jpg" data-ref-parent="fig-zebragaussian">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-zebragaussian-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Gaussian filter with <span class="math inline">\(\sigma=8\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-zebragaussian-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption>
</figure>
</div>
</section>
<section id="gaussian-filter-2" class="slide level2 smaller">
<h2>Gaussian Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Multiple dimensions</strong></p>
</div>
<div class="callout-content">
<p>Recall: <span id="eq-2dconv"><span class="math display">\[
\ell_{\texttt{out}}\left[n,m\right] = h \left[n,m\right] \circ \ell_{\texttt{in}}\left[n,m\right] =  \sum_{k,l}h \left[n-k,m-l \right] \ell_{\texttt{in}}\left[k,l \right]
\qquad(4)\]</span></span> <!-- The $n$-dimensional Gaussian filter has the additional computational advantage that it can be applied as a concatenation of $n$ 1D Gaussian filters (follows from @eq-gauss2dcont and @eq-2dconv). --></p>
<p>Letting <span class="math inline">\(g^x [n]=g[n,0]\)</span>, and <span class="math inline">\(g^y[m]=g[0,m]\)</span>), we have:</p>
<p><span class="math display">\[
g \left[n,m \right] \circ \ell \left[n,m\right]
= \sum_{k,l} g \left[n-k,m-l \right] \ell \left[k,l \right]
= \sum_{k,l} \exp{ \left( -\frac{(n-k)^2 + (m-l)^2}{2 \sigma^2} \right) } \circ \ell \left[n,m \right]
\]</span></p>
<p><span id="eq-2dgauss"><span class="math display">\[
= \sum_{k} \exp{ \left( -\frac{(n-k)^2}{2 \sigma^2} \right) }
\left( \sum_{l} \exp{ \left( -\frac{(m-l)^2}{2 \sigma^2} \right) } \ell \left[k,l \right] \right)
= g^x \circ (g^y \circ \ell \left[n,m \right])
\qquad(5)\]</span></span></p>
</div>
</div>
</div>
<!-- This can save quite a bit in computation time when applying the convolution of @eq-2dgauss. If the 2D convolution kernel is $N \times N$ samples, then a direct convolution of that 2D kernel scales in proportion to $N^2$, since @eq-2dgauss requires one multiplication per image position per kernel sample. Using the cascade of two 1D kernels, resulting in an equivalent 2D filter of the same size, scales in proportion to $2N$. -->
</section>
<section id="gaussian-filter-3" class="slide level2">
<h2>Gaussian Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Removing distractions</strong></p>
</div>
<div class="callout-content">
<div id="fig-lincoln" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-lincoln-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-lincoln" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-lincoln-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-lincoln-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/Jules_Lincoln_1971.jpg" data-ref-parent="fig-lincoln" height="400">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-lincoln-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Original Image.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-lincoln" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-lincoln-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-lincoln-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/Jules_Lincoln_1971_blur.jpg" data-ref-parent="fig-lincoln" height="400">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-lincoln-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Blurred Image.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-lincoln-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="gaussian-filter-4" class="slide level2">
<h2>Gaussian Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Properties of the Continuous Gaussian</strong></p>
</div>
<div class="callout-content">
<ul>
<li><strong>The <span class="math inline">\(n\)</span>-dimensional Gaussian is the only completely circularly symmetric operator that is separable.</strong></li>
<li><strong>The continuous Fourier transform (FT) of a Gaussian is also a Gaussian.</strong> For a 1D Gaussian, its Fourier transform is:</li>
</ul>
<p><span class="math display">\[
G (w; \sigma) = \exp{ \left( -\frac{w^2 \sigma^2} {2} \right) }
\]</span></p>
<p>and in 2D the Fourier transform is:</p>
<p><span id="eq-FTgauss2d"><span class="math display">\[
G (w_x, w_y; \sigma) = \exp{ \left(- \frac{(w_x^2+w_y^2) \sigma^2} {2} \right) }
\qquad(6)\]</span></span></p>
<p>Note that this function is monotonically decreasing in magnitude for increasing frequencies, and it is also radially symmetric.</p>
</div>
</div>
</div>
</section>
<section id="gaussian-filter-5" class="slide level2">
<h2>Gaussian Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Properties of the Continuous Gaussian</strong></p>
</div>
<div class="callout-content">
<ul>
<li><strong>The width of the Gaussian Fourier transform decreases with <span class="math inline">\(\sigma\)</span></strong> (this is the opposite behavior to the Gaussian in the spatial domain).</li>
<li><strong>The convolution of two <span class="math inline">\(n\)</span>-dimensional Gaussians is an <span class="math inline">\(n\)</span>-dimensional Gaussian.</strong></li>
</ul>
<p><span class="math display">\[
g (x,y; \sigma_1 ) \circ g (x,y; \sigma_2)  = g (x,y; \sigma_3)
\]</span></p>
<p>where the variance of the result is the sum <span class="math inline">\(\sigma_3^2 = \sigma_1^2 + \sigma_2^2\)</span>.</p>
<ul>
<li><strong>The Gaussian is the solution to the heat equation.</strong></li>
<li><strong>Repeated convolutions of any function concentrated in the origin result in a Gaussian (central limit theorem).</strong></li>
<li><strong>In the limit <span class="math inline">\(\sigma \rightarrow 0\)</span> the Gaussian becomes an impulse.</strong> This property is shared by many other functions, but it is a useful thing to know.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="gaussian-filter-6" class="slide level2">
<h2>Gaussian Filter</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Limitations</strong></p>
</div>
<div class="callout-content">
<p>The convolution of discretized Gaussians is not a Gaussian anymore.</p>
<p>Let’s consider a Gaussian with variance <span class="math inline">\(\sigma^2=1/2\)</span>. It can be approximated by five samples. We will call this approximation <span class="math inline">\(g_5\)</span> and it takes the values:</p>
<p><span class="math display">\[
g_5\left[ n \right] = \left[0.0183, \,    0.3679, \,    1.0000, \,    0.3679, \,    0.0183 \right]
\]</span></p>
<p>If we compute the approximation for <span class="math inline">\(\sigma^2=1\)</span> by discretizing the Gaussian, the result obtained is not equal to doing <span class="math inline">\(g_5 \circ g_5\)</span>: therefore, errors will accumulate.</p>
</div>
</div>
</div>
</section>
<section id="binomial-filters" class="slide level2 smaller">
<h2>Binomial Filters</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Definition</strong></p>
</div>
<div class="callout-content">
<p><strong>Binomial coefficients</strong>: a common approximation of the Gaussian filter, obtained by successive convolutions of the box filter <span class="math inline">\(\left[1,1\right]\)</span>.</p>
<p>The binomial coefficients use the central limit theorem to approximate a Gaussian as successive convolutions of a very simple function. The binomial coefficients form the <strong>Pascal’s triangle</strong> as shown in figure.</p>
<p><span class="math display">\[
\begin{array}{*{20}{&gt;{\centering\arraybackslash}p{.2cm}}{&gt;{\arraybackslash}p{1.5cm}}}
b_0 &amp;   ~ &amp;  ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; 1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~  &amp; ~ &amp; \sigma_0^2=0\\
b_1 &amp;    ~ &amp;  ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; 1 &amp; ~ &amp; 1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; \sigma_1^2=1/4\\
b_2 &amp;   ~ &amp;  ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; 1 &amp; ~ &amp; 2 &amp; ~ &amp; 1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; \sigma_2^2=1/2\\
b_3 &amp;  ~ &amp;  ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; 1 &amp; ~ &amp; 3 &amp; ~ &amp; 3 &amp; ~ &amp; 1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; \sigma_3^2=3/4\\
b_4 &amp;  ~ &amp;  ~ &amp; ~ &amp; ~ &amp; ~ &amp; 1 &amp; ~ &amp; 4 &amp; ~ &amp;  6 &amp; ~  &amp; 4 &amp; ~ &amp; 1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; \sigma_4^2=1\\
b_5 &amp;  ~ &amp;  ~ &amp; ~  &amp; ~ &amp; 1 &amp; ~   &amp; 5   &amp; ~   &amp;10  &amp;  ~  &amp; 10 &amp; ~   &amp; 5   &amp; ~   &amp; 1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; \sigma_5^2=5/4\\
b_6 &amp;  ~ &amp;  ~ &amp; ~  &amp; 1 &amp; ~ &amp; 6   &amp; ~   &amp; 15 &amp; ~   &amp; 20 &amp; ~   &amp; 15 &amp; ~   &amp; 6   &amp; ~ &amp; 1 &amp; ~ &amp; ~ &amp; ~ &amp; \sigma_6^2=3/2\\
b_7 &amp;  ~ &amp;  ~ &amp;  1 &amp; ~ &amp; 7 &amp; ~   &amp; 21 &amp; ~   &amp; 35 &amp; ~   &amp; 35 &amp; ~   &amp; 21 &amp; ~   &amp; 7 &amp; ~ &amp; 1 &amp; ~ &amp; ~ &amp; \sigma_7^2=7/4\\
b_8 &amp;  ~ &amp;  1 &amp; ~  &amp; 8 &amp; ~ &amp; 28 &amp; ~   &amp; 56 &amp; ~   &amp; 70 &amp; ~   &amp; 56 &amp; ~   &amp; 28 &amp; ~ &amp; 8 &amp; ~ &amp; 1 &amp; ~ &amp; \sigma_8^2=2
\end{array}
\]</span></p>
<p>Binomial coefficients. To build the Pascal’s triangle, each number is the sum of the number above to the left and the one above to the right.</p>
</div>
</div>
</div>
<!-- Each row of @fig-pascaltriangle shows one 1D-binomial kernel. The first binomial kernel, $b_0$, is the impulse. -->
</section>
<section id="binomial-filters-1" class="slide level2">
<h2>Binomial Filters</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Properties</strong></p>
</div>
<div class="callout-content">
<ul>
<li><p><strong>Binomial coefficients provide a compact approximation of the Gaussian coefficients using only integers.</strong> Note that the values of <span class="math inline">\(b_2\)</span> are different from <span class="math inline">\(g_5\)</span> despite that both will be used as approximations to a Gaussian with the same variance <span class="math inline">\(\sigma^2 = 1/2\)</span>. The thing to note is that the variance of <span class="math inline">\(g_5\)</span> is not really <span class="math inline">\(\sigma^2 = 1/2\)</span> despite being obtained by discretizing a Gaussian with that variance.</p></li>
<li><p><strong>The sum of all the coefficients (DC gain) for each binomial filter <span class="math inline">\(b_n\)</span> is <span class="math inline">\(2^n\)</span>, and their spatial variance is <span class="math inline">\(\sigma^2 = n/4\)</span>.</strong></p></li>
<li><p><strong>One remarkable property of the binomial filters is that <span class="math inline">\(b_n \circ b_m = b_{n+m}\)</span>, and, therefore, <span class="math inline">\(\sigma_n^2 + \sigma_m^2  = \sigma_{n+m}^2\)</span>, which is analogous to the Gaussian property in the continuous domain.</strong> That is, the convolution of two binomial filters is another binomial filter.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="binomial-filters-2" class="slide level2 smaller">
<h2>Binomial Filters</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Properties</strong></p>
</div>
<div class="callout-content">
<ul>
<li><strong>The simplest approximation to the Gaussian filter is the 3-tap binomial kernel:</strong></li>
</ul>
<p><span class="math display">\[
b_2 = \left[1, 2, 1\right]
\]</span></p>
<p>Its DFT is:</p>
<p><span class="math display">\[
B_2 \left[u\right] = 2+2 \cos (2 \pi u/N)
\]</span></p>
</div>
</div>
</div>
<div id="fig-gauss3filter" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-gauss3filter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gauss3filter" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-gauss3filter-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gauss3filter-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/gauss3filter_1d.png" data-ref-parent="fig-gauss3filter" height="200">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gauss3filter-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) 1D Binomial Filter.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gauss3filter" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-gauss3filter-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gauss3filter-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/gauss3filter_fourier.png" data-ref-parent="fig-gauss3filter" height="200">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gauss3filter-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Fourier Transform of Binomial Filter.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gauss3filter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Fig (a) A one-dimensional three-tap approximation to the Gaussian filter (<span class="math inline">\(\left[1,2,1\right]\)</span>) and, (b) its Fourier transform for <span class="math inline">\(N=20\)</span> samples.
</figcaption>
</figure>
</div>
</section>
<section id="binomial-filters-3" class="slide level2">
<h2>Binomial Filters</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Properties</strong></p>
</div>
<div class="callout-content">
<ul>
<li><strong>All the even binomial filters can be written as successive convolutions with the kernel <span class="math inline">\(\left[1,2,1\right]\)</span>.</strong> Therefore, their Fourier transform is a power of the Fourier transform of the filter <span class="math inline">\(\left[1,2,1\right]\)</span> and therefore they are also monotonic:</li>
</ul>
<p><span class="math display">\[
B_{2n} \left[u\right] = (2+2 \cos (2 \pi u/N))^n
\]</span></p>
<p>The filter transfer function, <span class="math inline">\(B_{2n}\)</span>, is real and positive. It is a <strong>zero-phase filter</strong>. </p>
<ul>
<li><strong>For all the binomial filters <span class="math inline">\(b_n\)</span>, when they are convolved with the wave <span class="math inline">\(\left[1,-1,1,-1,...\right]\)</span>, the result is the zero signal <span class="math inline">\(\left[0,0,0,0,...\right]\)</span>.</strong> This is a very nice property of binomial filters and will become very useful later when talking about downsampling an image.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="binomial-filters-4" class="slide level2">
<h2>Binomial Filters</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>2D Binomial Filters</strong></p>
</div>
<div class="callout-content">
<p>The Gaussian in 2D can be approximated, as the convolution of two binomial filters:</p>
<p><span class="math display">\[
b_{2,2} = b_{2,0} \circ b_{0,2} =  \begin{bmatrix}
  1 &amp; 2 &amp; 1 \\
\end{bmatrix}\circ \begin{bmatrix}
  1 \\
  2 \\
  1
\end{bmatrix}=
\begin{bmatrix}
  1 &amp; 2 &amp; 1 \\
  2 &amp; 4 &amp; 2\\
  1 &amp; 2 &amp; 1
\end{bmatrix}
\]</span></p>
<!-- The filter $b_{2,2}$ has a DC gain of 16, so we will divide the convolution output by 16 so that the output image has a similar contrast to the input image. -->
</div>
</div>
</div>
<p><img data-src="img/blur_filters/bin2.png" height="300"></p>
</section>
<section id="binomial-filters-5" class="slide level2">
<h2>Binomial Filters</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Example</strong></p>
</div>
<div class="callout-content">
<div class="columns">
<div class="column" style="width:33%;">
<div id="fig-boat_b_noise-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-boat_b_noise-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/boat_b_noise.jpg">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boat_b_noise-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Noisy Image.
</figcaption>
</figure>
</div>
</div><div class="column" style="width:33%;">
<div id="fig-boat_b_noise-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-boat_b_noise-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/boat_c_box.jpg">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boat_b_noise-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Box Filtered Image.
</figcaption>
</figure>
</div>
</div><div class="column" style="width:33%;">
<div id="fig-boat_b_noise-c" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-boat_b_noise-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/blur_filters/boat_d_binomial.jpg">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boat_b_noise-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Binomial Filtered Image.
</figcaption>
</figure>
</div>
</div></div>
<p>Image corrupted by a checkerboard-pattern noise (right) and its output to two different blur kernels: (middle) <span class="math inline">\(3 \times 3\)</span> box filter. (right) Binomial filter <span class="math inline">\(b_{2,2}\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="concluding-remarks" class="slide level2">
<h2>Concluding Remarks</h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<ul>
<li>the Gaussian and the binomial filters are widely used in computer vision.</li>
<li>the binomial filter <span class="math inline">\([1,2,1]/4\)</span> (here normalized so that its DC gain is 1), and its 2D extension, are very useful kernels that you can use in many situations like when you need to remove high-frequency noise, or downsample an image by a factor of 2.</li>
<li>Blur kernels are useful when building image pyramids, or in neural networks when performing different pooling operations or when resizing feature maps.</li>
</ul>
</div>
</div>
</div>
</section></section>
<section>
<section id="sec-image_derivatives" class="title-slide slide level1 center">
<h1>Image Derivatives</h1>

</section>
<section id="introduction-1" class="slide level2">
<h2>Introduction</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Derivatives</strong></p>
</div>
<div class="callout-content">
<p>Computing image derivatives is an essential operator for extracting useful information from images:</p>
<ul>
<li>boundaries computation</li>
<li>figuring out where changes are happening in the image.</li>
</ul>
<p>The derivative operator is linear and translation invariant <span class="math inline">\(\Rightarrow\)</span> can be written as a <strong>convolution.</strong></p>
</div>
</div>
</div>

<img data-src="img/derivatives/genericfilterH.png" style="width:60.0%" class="r-stretch quarto-figure-center" id="fig-genericfilterH"><p class="caption">
Figure&nbsp;12: Computing image derivatives along <span class="math inline">\(x\)</span>- and <span class="math inline">\(y\)</span>-dimensions.
</p></section>
<section id="image-derivatives" class="slide level2">
<h2>Image Derivatives</h2>
<div id="fig-derivativesmit" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-derivativesmit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-derivativesmit" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-derivativesmit-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-derivativesmit-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/derivatives/mit_der_a.jpg" id="fig-derivativesmit-a" data-ref-parent="fig-derivativesmit">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-derivativesmit-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-derivativesmit" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-derivativesmit-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-derivativesmit-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/derivatives/mit_der_b.jpg" id="fig-derivativesmit-b" data-ref-parent="fig-derivativesmit">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-derivativesmit-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-derivativesmit" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-derivativesmit-c" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-derivativesmit-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/derivatives/mit_der_c.jpg" id="fig-derivativesmit-c" data-ref-parent="fig-derivativesmit">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-derivativesmit-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-derivativesmit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: (left) Input image, (middle) its <span class="math inline">\(x\)</span>-derivative, and (right) its <span class="math inline">\(y\)</span>-derivative.
</figcaption>
</figure>
</div>
</section>
<section id="image-derivatives-1" class="slide level2">
<h2>Image Derivatives</h2>
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Discretizing</strong></p>
</div>
<div class="callout-content">
<p>If we had access to the continuous image, then image derivatives could be computed as: <span class="math inline">\(\partial \ell (x,y) / \partial x\)</span>, which is defined as:</p>
<p><span class="math display">\[
\frac{\partial \ell(x,y)} {\partial x} = \lim_{\epsilon \to 0} \frac{ \ell(x+\epsilon,y) -\ell(x,y)} {\epsilon}
\]</span></p>
<p>However, there are several reasons why we might not be able to apply this definition:</p>
<ul>
<li>We only have access to a sampled version of the input image, <span class="math inline">\(\ell \left[n,m\right]\)</span>, and we cannot compute the limit when <span class="math inline">\(\epsilon\)</span> goes to zero.</li>
<li>The image could contain many non-derivable points, and the gradient would not be defined. We will see how to address this issue later when we study Gaussian derivatives.</li>
<li>In the presence of noise, the image derivative might not be meaningful as it might just be dominated by the noise and not by the image content.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="image-derivatives-2" class="slide level2">
<h2>Image Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Approximation</strong></p>
</div>
<div class="callout-content">
<p>As the derivative is a linear operator, it can be approximated by a discrete linear filter.</p>
<p>Let’s start with <span class="math inline">\(d_0  = \left[1, -1 \right]\)</span>. In 1D, convolving a signal <span class="math inline">\(\ell \left[n \right]\)</span> with this filter results in: <span class="math display">\[
\ell \circ d_0 = \ell \left[n \right] - \ell \left[n-1 \right]
\]</span> This is due to the fact that <span class="math inline">\(d_0 \left[n\right]\)</span> is not centered around the origin.</p>
<p>This can be addressed with a different approximation to the spatial derivative <span class="math inline">\(d_1  = \left[1, 0, -1 \right]/2\)</span>. In one dimension, convolving a signal <span class="math inline">\(\ell \left[n \right]\)</span> with <span class="math inline">\(d_1 \left[n\right]\)</span> results in: <span class="math display">\[
\ell \circ d_1 = \frac{\ell \left[n+1 \right] - \ell \left[n-1 \right]}{2}
\]</span></p>
</div>
</div>
</div>
</section>
<section id="image-derivatives-3" class="slide level2 smaller">
<h2>Image Derivatives</h2>

<img data-src="img/derivatives/discretederivative.png" style="width:70.0%" class="r-stretch quarto-figure-center" id="fig-discretederivative"><p class="caption">
Figure&nbsp;14: (a) Input signal, <span class="math inline">\(\ell [n]\)</span>. (b) Convolutional kernel <span class="math inline">\(d_0 [n]\)</span>, defined as <span class="math inline">\(d_0 [0]=1\)</span> and <span class="math inline">\(d_0 [1]=-1\)</span> and zero everywhere else. (c) Output of the convolution between <span class="math inline">\(\ell [n]\)</span> and <span class="math inline">\(d_0 [n]\)</span>. (d) Kernel <span class="math inline">\(d_1 [n]\)</span>, defined as <span class="math inline">\(d_1 [-1]=1\)</span> and <span class="math inline">\(d_1 [1]=-1\)</span> and zero everywhere else. (e) Output of the convolution between <span class="math inline">\(\ell [n]\)</span> and <span class="math inline">\(d_1 [n]\)</span>.
</p></section>
<section id="image-derivatives-4" class="slide level2">
<h2>Image Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Approximation: continuous Fourier domain</strong></p>
</div>
<div class="callout-content">
<p>In the continuous domain, the relationship between the Fourier transform on a function and the Fourier transform of its derivative is: <span class="math display">\[
\frac{\partial \ell (x)}{\partial x}  
\xrightarrow{\mathscr{F}}
j w \mathscr{L} (w)
\]</span> In the continuous Fourier domain, derivation is equivalent to multiplying by <span class="math inline">\(jw\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="image-derivatives-5" class="slide level2">
<h2>Image Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Approximation: discrete Fourier domain</strong></p>
</div>
<div class="callout-content">
<p>The DFT of <span class="math inline">\(d_0 \left[n\right]\)</span> is: <span class="math display">\[
\begin{split}
D_0 \left[u \right] &amp; = 1 - \exp \left( -2 \pi j \frac{u}{N} \right)  \\
&amp; = \exp \left( - \pi j \frac{u}{N} \right) \left(  \exp \left( \pi j \frac{u}{N} \right) - \exp \left( -\pi j \frac{u}{N} \right)  \right) \\
&amp; = \exp \left( - \pi j \frac{u}{N} \right) 2 j \sin (\pi u /N)
\end{split}
\]</span> The first term is a pure phase shift, the second term is the amplitude gain.</p>
<p>The DFT of <span class="math inline">\(d_1 \left[n\right]\)</span> is: <span class="math display">\[
\begin{split}
D_1 \left[u \right] &amp; =  1/2\exp \left( 2 \pi j \frac{u}{N} \right) - 1/2 \exp \left( -2 \pi j \frac{u}{N} \right)  \\
&amp; =  j \sin (2 \pi u /N)
\end{split}
\]</span></p>
</div>
</div>
</div>
</section>
<section id="image-derivatives-6" class="slide level2">
<h2>Image Derivatives</h2>
<!-- @fig-d0andd1_dft shows the magnitude of $D_0\left[u \right]$ and $D_1\left[u \right]$ and compares it with $\left| 2 \pi u/N \right|$, which will be the ideal approximation to the derivative. The amplitude of $D_0\left[u \right]$ provides a better approximation to the ideal derivative, but the phase of $D_0\left[u \right]$ introduces a small shift in the output. Conversely, $D_1\left[u \right]$ has no shift, but it approximates the derivative over a smaller range of frequencies. The output to $D_1\left[u \right]$ is smoother than the output to $D_0\left[u \right]$, and, in particular, $D_1\left[u \right]$ gives a zero output when the input is the signal $\left[ 1, -1, 1, -1, ... \right]$. In fact, we can see that $\left[1,0,-1\right] = \left[1,-1\right] \circ \left[1,1\right]$, and, therefore $D_1\left[u \right] = D_0\left[u \right] B_1\left[u \right]$, where $B_1\left[u \right]$ is the DFT of the binomial filter $b_1 \left[n \right]$. -->

<img data-src="img/derivatives/d0andd1_dft.png" class="r-stretch quarto-figure-center" id="fig-d0andd1_dft"><p class="caption">
Figure&nbsp;15: Magnitude of (a) <span class="math inline">\(D_0\left[u \right]\)</span> and (b) <span class="math inline">\(D_1\left[u \right]\)</span> and comparison with <span class="math inline">\(\left| 2 \pi u/N \right|\)</span>, shown as a thin black line. Both DFTs are computed over 20 samples.
</p></section>
<section id="image-derivatives-7" class="slide level2 smaller">
<h2>Image Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Approximation in 2D</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>We can compute derivatives along the <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span> components:</li>
</ol>
<span class="math display">\[\begin{bmatrix}
  1 \\
  -1
\end{bmatrix}\]</span>
<span class="math display">\[\begin{bmatrix}
  1 &amp; -1
\end{bmatrix}\]</span>
<p><strong>Problem</strong>: outputs are spatially misaligned because a filter of length 2 shifts the output image by half a pixel as we discussed earlier.</p>
<ol start="2" type="1">
<li>We can use a rotated reference frame as it is done in the <strong>Roberts cross</strong> operator (1963):</li>
</ol>
<span class="math display">\[\begin{bmatrix}
  1 &amp; ~0\\
  0 &amp; -1
\end{bmatrix}\]</span>
<span class="math display">\[\begin{bmatrix}
  ~0 &amp; 1 \\
  -1 &amp; 0
\end{bmatrix}\]</span>
<p>Now, both outputs are spatially aligned because they are shifted in the same way.</p>
</div>
</div>
</div>
</section>
<section id="gradient-based-image-representation" class="slide level2 smaller">
<h2>Gradient-Based Image Representation</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Recovering original image</strong></p>
</div>
<div class="callout-content">
<p>Perhaps by integrating?</p>
<p>This is the matrix that corresponds to the convolution with the kernel <span class="math inline">\(\left[1, -1 \right]\)</span> that we will call <span class="math inline">\(\mathbf{D_0}\)</span>. The next two matrices show the matrix <span class="math inline">\(\mathbf{D_0}\)</span> and its inverse <span class="math inline">\(\mathbf{D_0}^{-1}\)</span> for a 1D image of length five pixels using zero boundary conditions:</p>
<p><span class="math display">\[
\mathbf{D_0} =
\begin{bmatrix}
  1 ~&amp; 0 ~&amp; 0 ~&amp; 0~&amp; 0 \\
  -1 ~&amp; 1 ~&amp; 0 ~&amp; 0~&amp; 0 \\
  0 ~&amp; -1 ~&amp; 1 ~&amp; 0 ~&amp; 0\\
  0~&amp; 0 ~&amp; -1 ~&amp; 1 ~&amp; 0\\
  0~&amp; 0 ~&amp; 0 ~&amp; -1 ~&amp; 1
\end{bmatrix}
\]</span></p>
<p><span class="math display">\[
\mathbf{D_0}^{-1} =
\begin{bmatrix}
  1 ~&amp;~ 0 ~&amp;~ 0 ~&amp;~ 0~&amp;~ 0 \\
  1 ~&amp;~ 1 ~&amp;~ 0 ~&amp;~ 0~&amp;~ 0 \\
  1 ~&amp;~ 1 ~&amp;~ 1 ~&amp;~ 0 ~&amp;~ 0\\
  1~&amp;~ 1 ~&amp;~ 1 ~&amp;~ 1 ~&amp;~ 0\\
  1~&amp;~ 1 ~&amp;~ 1 ~&amp;~ 1 ~&amp;~ 1
\end{bmatrix}
\]</span> First sample of the derivative gets to see the actual value of the input signal, and then we can integrate back the entire signal.</p>
</div>
</div>
</div>
</section>
<section id="gradient-based-image-representation-1" class="slide level2">
<h2>Gradient-Based Image Representation</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Recovering original image</strong></p>
</div>
<div class="callout-content">
<p>But what happens if you only get to see valid differences and you remove any pixel that was affected by the boundary? In this case, the derivative operator in matrix form is:</p>
<p><span class="math display">\[
\mathbf{D_0} =
\begin{bmatrix}
  -1 ~&amp; 1 ~&amp; 0 ~&amp; 0~&amp; 0 \\
  0 ~&amp; -1 ~&amp; 1 ~&amp; 0 ~&amp; 0\\
  0~&amp; 0 ~&amp; -1 ~&amp; 1 ~&amp; 0\\
  0~&amp; 0 ~&amp; 0 ~&amp; -1 ~&amp; 1
\end{bmatrix}
\]</span></p>
</div>
</div>
</div>
</section>
<section id="gradient-based-image-representation-2" class="slide level2 smaller">
<h2>Gradient-Based Image Representation</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Recovering original image</strong></p>
</div>
<div class="callout-content">
<p>Let’s consider the next 1D input signal:</p>
<p><span class="math display">\[
\boldsymbol\ell = \left[1, 1, 2, 2, 0\right]
\]</span></p>
<p>Then, the output of the derivative operator is:</p>
<p><span class="math display">\[
\mathbf{r}=\mathbf{D_0} \boldsymbol\ell=\left[0, -1, 0, 2\right]
\]</span></p>
<p><span class="math display">\[
\mathbf{D_0}^{+} = \frac{1}{5}
\begin{bmatrix}
  -4 ~&amp; -3 ~&amp; -2~&amp; -1 \\
  1 ~&amp; -3 ~&amp; -2 ~&amp;-1 \\
  1~&amp; 2 ~&amp; -2 ~&amp; -1\\
  1~&amp; 2 ~&amp; 3 ~&amp; -1\\
  1~&amp; 2 ~&amp; 3 ~&amp; 4
\end{bmatrix}
\]</span></p>
<p>In this example, the reconstructed input is:</p>
<p><span class="math display">\[
\hat{\boldsymbol\ell} = \mathbf{D_0}^{+} \mathbf{r} =
\left[-0.2, -0.2, 0.8, 0.8, -1.2 \right]
\]</span> Note that <span class="math inline">\(\hat{\boldsymbol\ell}\)</span> is a zero mean vector. In fact, the recovered input is a shifted version of the original input, <span class="math inline">\(\hat{\boldsymbol\ell} = \boldsymbol\ell - 1.2\)</span>, where 1.2 is the mean value of samples on <span class="math inline">\(\boldsymbol\ell\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="sec-editinggradientdomain" class="slide level2">
<h2>Image Editing in the Gradient Domain</h2>

<img data-src="img/derivatives/edit_with_derivatives.png" class="r-stretch quarto-figure-center" id="fig-edit_with_derivatives"><p class="caption">
Figure&nbsp;16: Image inpainting: Using image derivatives, we delete the word “stop” by setting to zero the gradients indicated by the mask. The resulting decoded image propagates the red color inside the region that contained the word.
</p></section>
<section id="image-editing-in-the-gradient-domain" class="slide level2">
<h2>Image Editing in the Gradient Domain</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Encoding/Decoding</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li><p>First, the image is <strong>encoded</strong> using derivatives along the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> dimensions: <span class="math display">\[
\mathbf{r} =
\left[
\begin{array}{c}
\mathbf{D_x}  \\
\mathbf{D_y}
\end{array}
\right]
\boldsymbol\ell
\]</span></p></li>
<li><p>The resulting representation, <span class="math inline">\(\mathbf{r}\)</span>, contains the concatenation of the output of both derivative operators. <span class="math inline">\(\mathbf{r}\)</span> will have high values in the image regions that contain changes in pixel intensities and colors and will be near zero in regions with small variations.</p></li>
<li><p>This representation can be <strong>decoded</strong> back into the input image by using the pseudoinverse as we did in the 1D case. The pseudoinverse can be efficiently computed in the Fourier domain.</p></li>
</ol>
</div>
</div>
</div>
</section>
<section id="gaussian-derivatives" class="slide level2">
<h2>Gaussian Derivatives</h2>
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Noise sensitivity</strong></p>
</div>
<div class="callout-content">
<div id="fig-derivativesnoisystop" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-derivativesnoisystop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-derivativesnoisystop" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-derivativesnoisystop-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-derivativesnoisystop-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/derivatives/stop_noise.jpg" id="fig-derivativesnoisystop-a" data-ref-parent="fig-derivativesnoisystop">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-derivativesnoisystop-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-derivativesnoisystop" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-derivativesnoisystop-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-derivativesnoisystop-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/derivatives/stop_noise_gradient.jpg" id="fig-derivativesnoisystop-b" data-ref-parent="fig-derivativesnoisystop">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-derivativesnoisystop-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-derivativesnoisystop" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-derivativesnoisystop-c" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-derivativesnoisystop-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/derivatives/stop_noise_gaussian_gradient.jpg" id="fig-derivativesnoisystop-c" data-ref-parent="fig-derivativesnoisystop">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-derivativesnoisystop-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-derivativesnoisystop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Derivatives of a noisy image. (a) Input image with noise, (b) its <span class="math inline">\(x\)</span>-derivative obtained by convolving with a kernel <span class="math inline">\([1, -1]\)</span>, and (c) its <span class="math inline">\(x\)</span>-derivative obtained using a Gaussian derivative kernel.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="gaussian-derivatives-1" class="slide level2">
<h2>Gaussian Derivatives</h2>
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Undefined derivative</strong></p>
</div>
<div class="callout-content">
<p>Consider an image in the continuous domain with the form <span class="math inline">\(\ell (x,y) = 0\)</span> if <span class="math inline">\(x&lt;0\)</span> and 1 otherwise.</p>
<ul>
<li>If we try to compute <span class="math inline">\(\partial \ell (x,y) / \partial x\)</span>, we will get 0 everywhere, but around <span class="math inline">\(x=0\)</span> the value of the derivative is not defined.</li>
<li>We avoided this issue in the previous section because for discrete images the approximation of the derivative is always defined.</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Solution</strong></p>
</div>
<div class="callout-content">
<p><strong>Gaussian derivatives</strong> address these two issues. They were popularized by Koenderink and Van Doorm <span class="citation" data-cites="Koenderink87">@Koenderink87</span> as a model of neurons in the visual system.</p>
</div>
</div>
</div>
</section>
<section id="gaussian-derivatives-2" class="slide level2">
<h2>Gaussian Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Observation: commutativity</strong></p>
</div>
<div class="callout-content">
<p>Let’s start with the following observation. For two functions defined in the continuous domain <span class="math inline">\(\ell(x,y)\)</span> and <span class="math inline">\(g(x,y)\)</span>, the convolution and the derivative are commutative: <span class="math display">\[
\frac {\partial \ell(x,y)}{\partial x} \circ g(x,y) = \ell(x,y) \circ \frac {\partial g(x,y)}{\partial x}
\]</span></p>
<p>Instead of computing the derivative of the image we can compute the derivatives of the filter kernel and convolve it with the image.</p>
</div>
</div>
</div>
</section>
<section id="gaussian-derivatives-3" class="slide level2">
<h2>Gaussian Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Smoothing</strong></p>
</div>
<div class="callout-content">
<p>If <span class="math inline">\(g(x,y)\)</span> is a blurring kernel, it will smooth the derivatives, reducing the output noise at the expense of a loss in spatial resolution. A common smoothing kernel for computing derivatives is the Gaussian kernel.</p>
<p>If <span class="math inline">\(g\)</span> is a Gaussian, then the first-order derivative is <span id="eq-derivate1gauss2dcont"><span class="math display">\[
\begin{split}
g_x(x,y; \sigma) &amp; = \frac {\partial g(x,y; \sigma)}{\partial x} \\
&amp; = \frac{-x}{2 \pi \sigma^4} \exp{-\frac{x^2 +
   y^2}{2 \sigma^2}} \\
&amp; = \frac{-x}{\sigma^2} g(x,y; \sigma)
\end{split}
\qquad(7)\]</span></span></p>
</div>
</div>
</div>
</section>
<section id="gaussian-derivatives-4" class="slide level2">
<h2>Gaussian Derivatives</h2>
<div id="fig-gaussian-derivative" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-gaussian-derivative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gaussian-derivative" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-gaussian-derivative-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gaussian-derivative-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/derivatives/gaussian_sigma_1.png" id="fig-gaussian-derivative-a" data-ref-parent="fig-gaussian-derivative">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gaussian-derivative-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gaussian-derivative" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-gaussian-derivative-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gaussian-derivative-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/derivatives/gaussian_x_derivative_sigma_1.png" id="fig-gaussian-derivative-b" data-ref-parent="fig-gaussian-derivative">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gaussian-derivative-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gaussian-derivative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Fig (a) 2D Gaussian with <span class="math inline">\(\sigma=1\)</span>, and (b) its <span class="math inline">\(x\)</span>-derivative.
</figcaption>
</figure>
</div>
</section>
<section id="gaussian-derivatives-5" class="slide level2 smaller">
<h2>Gaussian Derivatives</h2>
<div id="fig-gaussiander_zebra" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-gaussiander_zebra-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gaussiander_zebra" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-gaussiander_zebra-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gaussiander_zebra-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/gausian_der_c_2.jpg" id="fig-gaussiander_zebra-a" data-ref-parent="fig-gaussiander_zebra" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gaussiander_zebra-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gaussiander_zebra" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-gaussiander_zebra-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gaussiander_zebra-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/gausian_der_c_4.jpg" id="fig-gaussiander_zebra-b" data-ref-parent="fig-gaussiander_zebra" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gaussiander_zebra-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gaussiander_zebra" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-gaussiander_zebra-c" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gaussiander_zebra-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/gausian_der_c_8.jpg" id="fig-gaussiander_zebra-c" data-ref-parent="fig-gaussiander_zebra" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gaussiander_zebra-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gaussiander_zebra" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-gaussiander_zebra-d" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gaussiander_zebra-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/gausian_der_c_2plot.jpg" id="fig-gaussiander_zebra-d" data-ref-parent="fig-gaussiander_zebra" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gaussiander_zebra-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gaussiander_zebra" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-gaussiander_zebra-e" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gaussiander_zebra-e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/gausian_der_c_4plot.jpg" id="fig-gaussiander_zebra-e" data-ref-parent="fig-gaussiander_zebra" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gaussiander_zebra-e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-gaussiander_zebra" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-gaussiander_zebra-f" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-gaussiander_zebra-f-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/gausian_der_c_8plot.jpg" id="fig-gaussiander_zebra-f" data-ref-parent="fig-gaussiander_zebra" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-gaussiander_zebra-f-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gaussiander_zebra-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: An image filtered with three Gaussian derivatives: Fig (a) <span class="math inline">\(\sigma=2\)</span>; (b) <span class="math inline">\(\sigma=4\)</span>; and (c) <span class="math inline">\(\sigma=8\)</span>. Plots (d-f) show the three Gaussian derivatives over the same spatial support as the image. The discrete functions are approximated by sampling the continuous Gaussian derivatives. The convolutions are performed with mirror boundary extension.
</figcaption>
</figure>
</div>
</section>
<section id="high-order-gaussian-derivatives" class="slide level2">
<h2>High-Order Gaussian Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Computation</strong></p>
</div>
<div class="callout-content">
<p>The second-order derivative of a Gaussian is: <span class="math display">\[
g_{x^2}(x,y; \sigma) = \frac{x^2-\sigma^2}{\sigma^4} g(x,y; \sigma)
\]</span></p>
<p>The general expression for the <span class="math inline">\(n\)</span> derivative of a Gaussian is: <span class="math display">\[
g_{x^n}(x; \sigma) =  \frac{\partial^{n} g(x)}{\partial x^n} =
\left( \frac{-1}{\sigma \sqrt{2}} \right)^n
H_n\left( \frac{x}{\sigma \sqrt {2}} \right)
g(x; \sigma)
\]</span></p>
<p>The first Hermite polynomial is <span class="math inline">\(H_0(x)=1\)</span>, the second is <span class="math inline">\(H_1(x) = 2x\)</span>, the third is <span class="math inline">\(H_2(x)=4x^2-2\)</span>, and they can be computed recursively as: <span class="math display">\[
H_n(x) = 2x H_{n-1}(x) - 2(n-1)H_{n-2}(x)
\]</span></p>
</div>
</div>
</div>
</section>
<section id="high-order-gaussian-derivatives-1" class="slide level2">
<h2>High-Order Gaussian Derivatives</h2>

<img data-src="img/derivatives/gaussian_gaussiander.png" class="r-stretch quarto-figure-center" id="fig-gaussian_gaussiander"><p class="caption">
Figure&nbsp;20: Fig (a) 1D Gaussian with <span class="math inline">\(\sigma=1\)</span>. (b–d) Gaussian derivatives up to order 3.
</p></section>
<section id="high-order-gaussian-derivatives-2" class="slide level2">
<h2>High-Order Gaussian Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partial derivatives</strong></p>
</div>
<div class="callout-content">
<p>In two dimensions, as the Gaussian is separable, the partial derivatives result on the product of two Hermite polynomial, one for each spatial dimension:</p>
<p><span id="eq-derivate2gauss2dhermite"><span class="math display">\[
\begin{split}
g_{x^n,y^m}(x,y; \sigma) &amp; =  
\frac{\partial^{n+m} g(x,y)}{\partial x^n \partial y^m} \\
&amp; = \left( \frac{-1}{\sigma \sqrt{2}} \right)^{n+m}
H_n\left( \frac{x}{\sigma \sqrt {2}} \right)
H_m\left( \frac{y}{\sigma \sqrt {2}} \right)
g(x,y; \sigma)
\end{split}
\qquad(8)\]</span></span></p>
</div>
</div>
</div>
</section>
<section id="high-order-gaussian-derivatives-3" class="slide level2">
<h2>High-Order Gaussian Derivatives</h2>

<img data-src="img/spatial_filters/gauss_derivatives_triangle.png" style="width:80.0%" class="r-stretch quarto-figure-center" id="fig-gauss_derivatives_triangle"><p class="caption">
Figure&nbsp;21: Gaussian derivatives up to order 6. All the kernels are separable. They seem similar to Fourier basis multiplied with a Gaussian window.<br>
<a href="#/fig-gauss_derivatives_triangle_FT" class="quarto-xref">Figure&nbsp;22</a> shows that they are different from sine and cosine waves; instead, they look more like products of cosine and sine waves.
</p></section>
<section id="high-order-gaussian-derivatives-4" class="slide level2">
<h2>High-Order Gaussian Derivatives</h2>

<img data-src="img/spatial_filters/gauss_derivatives_triangle_FT.png" style="width:80.0%" class="r-stretch quarto-figure-center" id="fig-gauss_derivatives_triangle_FT"><p class="caption">
Figure&nbsp;22: Fourier transform of the Gaussian derivatives shown in <a href="#/fig-gauss_derivatives_triangle" class="quarto-xref">Figure&nbsp;21</a>.
</p></section>
<section id="high-order-gaussian-derivatives-5" class="slide level2">
<h2>High-Order Gaussian Derivatives</h2>

<img data-src="img/derivatives/fig_gauss_derivatives_triangle_mondrian.png" style="width:80.0%" class="r-stretch quarto-figure-center"><p class="caption">An image containing a square and a circle and its output to the Gaussian derivatives up to order 3.</p></section>
<section id="sec-derivatives_binomial_filters" class="slide level2 smaller">
<h2>Derivatives using Binomial Filters</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Discrete approximations</strong></p>
</div>
<div class="callout-content">
<p>When processing images we have to use discrete approximations for the Gaussian derivatives. After discretization, many of the properties of the continuous Gaussian will not hold exactly.</p>
<p>There are many discrete approximations. For instance, we can take samples of the continuous functions. In practice it is common to use the discrete approximation given by the binomial filters. Below is the result of convolving the binomial coefficients, <span class="math inline">\(b_n\)</span>, with <span class="math inline">\(\left[1, -1\right]\)</span>.</p>
<span class="math display">\[\begin{array}{ccccccccccccccccccccl}
d_0 &amp;    ~ &amp;  ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~~1 &amp; ~~~ &amp; -1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp;\\
d_1 &amp;    ~ &amp;  ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~~1 &amp; ~ &amp; ~~0 &amp; ~ &amp; -1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; \\
d_2 &amp;    ~ &amp;  ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~~~1 &amp; ~ &amp; ~~~1 &amp; ~~~ &amp; -1 &amp; ~ &amp; -1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; \\
d_3 &amp;    ~ &amp;  ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~~~1 &amp; ~ &amp; ~~~2 &amp; ~ &amp;  ~~0 &amp; ~~~  &amp; -2 &amp; ~ &amp; -1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp;\\
d_4 &amp;    ~ &amp;  ~ &amp; ~  &amp; ~ &amp; ~~~1 &amp; ~   &amp; ~~~3   &amp; ~   &amp; ~~~2  &amp;  ~~~  &amp; -2 &amp; ~   &amp; -3   &amp; ~   &amp; -1 &amp; ~ &amp; ~ &amp; ~ &amp; ~ &amp;\\
d_5 &amp;    ~ &amp;  ~ &amp; ~  &amp; ~~~1 &amp; ~ &amp; ~~~4   &amp; ~   &amp; ~~~5 &amp; ~   &amp; ~~0 &amp; ~   &amp; -5 &amp; ~   &amp; -4   &amp; ~ &amp; -1 &amp; ~ &amp; ~ &amp; ~ &amp;
\end{array}\]</span>
<p>Derivative of binomial coefficients resulting from the convolution <span class="math inline">\(b_n \circ \left[1, -1\right]\)</span>. The filters, <span class="math inline">\(d_0\)</span> and <span class="math inline">\(d_1\)</span>, are the ones we have studied in the previous section.</p>
</div>
</div>
</div>
</section>
<section id="derivatives-using-binomial-filters" class="slide level2 smaller">
<h2>Derivatives using Binomial Filters</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Sobel operator</strong></p>
</div>
<div class="callout-content">
<p>In two dimensions, we can use separable filters and build a partial derivative as:</p>
<p><span class="math display">\[
Sobel_x =  \begin{bmatrix}
  1 &amp; 0 &amp; -1 \\
\end{bmatrix} \circ \begin{bmatrix}
  1 \\
  2 \\
  1
\end{bmatrix} =
\begin{bmatrix}
  1 &amp; 0 &amp; -1 \\
  2 &amp; 0 &amp; -2 \\
  1 &amp; 0 &amp; -1
\end{bmatrix}
\]</span></p>
<p><span id="eq-sobel_kernels"><span class="math display">\[
Sobel_y =  \begin{bmatrix}
  -1 &amp; -2 &amp; -1 \\
  0 &amp; 0 &amp; 0 \\
  1 &amp; 2 &amp; 1
\end{bmatrix}
\qquad(9)\]</span></span></p>
<p>This particular filter is called the <strong>Sobel-Feldman operator</strong>.<br>
The goal of this operator was to be compact and as isotropic as possible. The Sobel-Feldman operator can be implemented very efficiently as it can be written as the convolution with four small kernels, <span class="math display">\[Sobel_x = b_1 \circ d_0 \circ b_1^T \circ b_1^T.\]</span></p>
</div>
</div>
</div>

<aside><div>
<p>Remember that (b_1=[1, 1]), and (b_2=b_1 b_1 = [1,2,1]).</p>
</div></aside></section>
<section id="derivatives-using-binomial-filters-1" class="slide level2">
<h2>Derivatives using Binomial Filters</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>DFT of the Sobel-Feldman operator</strong></p>
</div>
<div class="callout-content">
<p>The DFT of the Sobel-Feldman operator is:</p>
<p><span class="math display">\[
Sobel_x \left[u,v \right] = D_1\left[u\right] B_2 \left[v \right] = j \sin \left( 2 \pi u /N \right) \left( 2+2 \cos \left(2 \pi v/N \right) \right)
\]</span></p>
</div>
</div>
</div>

<img data-src="img/spatial_filters/DFTderivativeoperators.png" style="width:100.0%" class="r-stretch quarto-figure-center" id="fig-DFTderivativeoperators"><p class="caption">
Figure&nbsp;23: Magnitude of the DFT of four different discretizations of Gaussian derivatives: (a) (d_0); (b) (d_1); (c) Robert cross operator; and (d) Sobel-Feldman operator.
</p></section>
<section id="derivatives-using-binomial-filters-2" class="slide level2 smaller">
<h2>Derivatives using Binomial Filters</h2>

<img data-src="img/spatial_filters/circle.png" style="width:100.0%" class="r-stretch quarto-figure-center" id="fig-circle"><p class="caption">
Figure&nbsp;24: Derivatives of a circle along the directions <span class="math inline">\(n\)</span>, <span class="math inline">\(m\)</span>, and 45 degrees. The angle is shown only where the magnitude is <span class="math inline">\(&gt;0\)</span>. The derivative output along 45 degrees is obtained as a linear combination of the derivatives outputs along <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span>. Check the differences among the different kernels. The Sobel operator gives the most rotationally invariant gradient magnitude, but it is blurrier.
</p></section>
<section id="directional-derivatives" class="slide level2 smaller">
<h2>Directional Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Image gradient</strong></p>
</div>
<div class="callout-content">
<p>From the image derivatives, we can also define the image gradient as the vector: <span class="math display">\[
\nabla \ell (x,y) = \left( \frac{\partial \ell(x,y)}{\partial x}, \frac{\partial \ell(x,y)}{\partial y} \right)
\]</span> For each pixel, the output is a 2D vector. In the case of using Gaussian derivatives, we can write: <span class="math display">\[
\nabla \ell \circ g = \nabla g \circ \ell = \left( g_x(x,y), g_y(x,y) \right) \circ \ell
\]</span></p>
<p>Although we have mostly computed derivatives along the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> variables, we can obtain the derivative in any orientation as a linear combination of the two derivatives along the main axes. With <span class="math inline">\({\bf t}=\left( \cos (\theta), \sin(\theta) \right)\)</span>, we can write the directional derivative along the vector <span class="math inline">\({\bf t}\)</span> as: <span class="math display">\[
\frac{\partial \ell (x,y)}{\partial {\bf t}} =  \nabla \ell \cdot {\bf t} = \cos(\theta) \frac{\partial \ell}{\partial x} + \sin(\theta) \frac{\partial \ell}{\partial y}
\]</span></p>
</div>
</div>
</div>
</section>
<section id="directional-derivatives-1" class="slide level2 smaller">
<h2>Directional Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Image gradient</strong></p>
</div>
<div class="callout-content">
<p>In the Gaussian case: <span id="eq-steerable_derivative_filter"><span class="math display">\[
\begin{split}
\frac{\partial \ell}{\partial {\bf t}} \circ g &amp; = \left( \cos(\theta) g_x(x,y) + \sin(\theta) g_y(x,y) \right) \circ \ell \\
&amp; = \left( \nabla g  \cdot {\bf t} \right) \circ \ell \\
&amp; = g_{\theta} (x,y)  \circ \ell(x,y)
\end{split}
\qquad(10)\]</span></span></p>
<p>with <span class="math inline">\(g_{\theta} (x,y) = \cos(\theta) g_x(x,y) + \sin(\theta) g_y(x,y)\)</span>.</p>
<p>However, to compute the derivative along any arbitrary angle <span class="math inline">\(\theta\)</span> does not require doing new convolutions. Instead, we can compute any derivative as a linear combination of the output of convolving the image with <span class="math inline">\(g_x(x,y)\)</span> and <span class="math inline">\(g_y(x,y)\)</span>: <span class="math display">\[
\frac{\partial \ell}{\partial {\bf t}} \circ g =  \cos(\theta) g_x(x,y) \circ \ell + \sin(\theta) g_y(x,y) \circ \ell(x,y)
\]</span></p>
</div>
</div>
</div>
</section>
<section id="directional-derivatives-2" class="slide level2 smaller">
<h2>Directional Derivatives</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Image gradient</strong></p>
</div>
<div class="callout-content">
<p>When using discrete convolutional kernels <span class="math inline">\(d_n\left[n,m\right]\)</span> and <span class="math inline">\(d_m\left[n,m\right]\)</span> to approximate the derivatives along <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span>, it can be written as: <span class="math display">\[
\nabla \ell = \left( d_n\left[n,m\right], d_m\left[n,m\right] \right) \circ \ell \left[n,m\right]
\]</span> and <span class="math display">\[
\frac{\partial \ell}{\partial {\bf t}} \circ g = d_{\theta} \left[n,m\right] \circ \ell \left[n,m\right]
\]</span></p>
<p>with <span class="math inline">\(d_{\theta} \left[n,m\right]  = \cos(\theta) d_n\left[n,m\right] + \sin(\theta) d_m\left[n,m\right]\)</span>. We expect that the linear combination of these two kernels should approximate the derivative along the direction <span class="math inline">\(\theta\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="image-laplacian" class="slide level2">
<h2>Image Laplacian</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Definition</strong></p>
</div>
<div class="callout-content">
<p>The <strong>Laplacian filter</strong> was made popular by Marr and Hildreth in 1980 in the search for operators that locate the <strong>boundaries between objects</strong>.</p>
<p><span class="math display">\[
\nabla^2 \ell = \frac{\partial^2 \ell}{\partial x^2} + \frac{\partial^2 \ell}{\partial y^2}
\]</span></p>
</div>
</div>
</div>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>The Laplacian is more sensitive to noise than the first order derivative.</p>
</div>
</div>
</div>

<aside><div>
<p>One example of application of the Laplacian is in the paper <em>Can One Hear the Shape of a Drum</em>, where the Laplacian is used for modeling vibrations in a drum and the sounds it produces as a function of its shape.</p>
</div></aside></section>
<section id="image-laplacian-1" class="slide level2">
<h2>Image Laplacian</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Smoothing</strong></p>
</div>
<div class="callout-content">
<p>It is useful to smooth the output with a Gaussian kernel, <span class="math inline">\(g(x,y)\)</span>. We can write,</p>
<p><span class="math display">\[
\nabla^2 \ell \circ g = \nabla^2 g \circ \ell
\]</span></p>
<p>Therefore, the same result can be obtained if we first compute the Laplacian of the Gaussian kernel, <span class="math inline">\(g(x,y)\)</span> and then convolve it with the input image. The Laplacian of the Gaussian is</p>
<p><span class="math display">\[
\nabla^2 g = \frac{x^2 + y^2 -2\sigma^2}{\sigma^4} g(x,y)
\]</span></p>
</div>
</div>
</div>
</section>
<section id="image-laplacian-2" class="slide level2">
<h2>Image Laplacian</h2>

<img data-src="img/derivatives/hat.png" style="width:45.0%" class="r-stretch quarto-figure-center" id="fig-mexican_hat_wavelet"><p class="caption">
Figure&nbsp;25: The Gaussian Laplacian (<span class="math inline">\(\sigma = 1\)</span>) is also called the inverted <strong>mexican hat wavelet</strong>. (a) 2D plot. (b) 1D section at <span class="math inline">\(y=0\)</span>.
</p></section>
<section id="image-laplacian-3" class="slide level2 smaller">
<h2>Image Laplacian</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Discrete approximation</strong></p>
</div>
<div class="callout-content">
<p>In one dimension, the Laplacian can be approximated by <span class="math inline">\([1,-2,1]\)</span>, which is the result of the convolution of two 2-tap discrete approximations of the derivative <span class="math inline">\([1,-1] \circ [1,-1]\)</span>. In two dimensions, the most popular approximation is the five-point formula, which consists of convolving the image with the kernel:</p>
<p><span id="eq-five_point_laplacian"><span class="math display">\[
\nabla_5^2 =
\begin{bmatrix}
  0 &amp; 1 &amp; 0 \\
  1 &amp; -4 &amp; 1\\
  0 &amp; 1 &amp; 0
\end{bmatrix}
\qquad(11)\]</span></span></p>
<!-- It involves the central pixel and its four nearest neighbors. This is a sum-separable kernel: it corresponds to approximating the second-order derivative for each coordinate and summing the result (i.e., convolve the image with $[1,-2,1]$ and also with its transpose and summing the two outputs). -->
<p>The Laplacian of the image, using the five-point formula, is: <span class="math display">\[
\begin{split}
\nabla_5^2 \ell[n,m] = &amp; - 4 \ell[n,m] \\
                     &amp;  + \ell[n+1,m] \\
                     &amp;  + \ell[n-1,m] \\
                     &amp;  + \ell[n,m+1] \\
                     &amp;  + \ell[n,m-1]
\end{split}
\]</span></p>
</div>
</div>
</div>
</section>
<section id="image-laplacian-4" class="slide level2">
<h2>Image Laplacian</h2>

<img data-src="img/spatial_filters/DFTlaplacians.png" style="width:100.0%" class="r-stretch quarto-figure-center" id="fig-DFTlaplacians"><p class="caption">
Figure&nbsp;26: Magnitude of the DFT of the Gaussian Laplacian with (a) <span class="math inline">\(\sigma=1/2\)</span>; (b) <span class="math inline">\(\sigma=1\)</span>; (c) <span class="math inline">\(\sigma=2\)</span>; and (d) DFT of the five-point discrete approximation, <a href="#/eq-five_point_laplacian" class="quarto-xref">Equation&nbsp;11</a>.
</p></section>
<section id="image-laplacian-5" class="slide level2">
<h2>Image Laplacian</h2>
<div id="fig-wheellaplacian" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-wheellaplacian-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-wheellaplacian" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-wheellaplacian-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-wheellaplacian-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/wheel256.jpg" id="fig-wheellaplacian-a" data-ref-parent="fig-wheellaplacian">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-wheellaplacian-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-wheellaplacian" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-wheellaplacian-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-wheellaplacian-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/wheelLaplacianx.jpg" id="fig-wheellaplacian-b" data-ref-parent="fig-wheellaplacian">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-wheellaplacian-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-wheellaplacian" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-wheellaplacian-c" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-wheellaplacian-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/wheelLaplaciany.jpg" id="fig-wheellaplacian-c" data-ref-parent="fig-wheellaplacian">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-wheellaplacian-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-wheellaplacian" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-wheellaplacian-d" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-wheellaplacian-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/wheelLaplacian.jpg" id="fig-wheellaplacian-d" data-ref-parent="fig-wheellaplacian">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-wheellaplacian-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wheellaplacian-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27: Fig (a) Input image. (b) Second order derivative along <span class="math inline">\(x\)</span>. (c) Second-order derivative along <span class="math inline">\(y\)</span>. (d) The sum of (b) + (c), which gives the Laplacian.
</figcaption>
</figure>
</div>
</section>
<section id="image-laplacian-6" class="slide level2">
<h2>Image Laplacian</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Advantages</strong></p>
</div>
<div class="callout-content">
<ul>
<li>It is rotationally invariant. It is a linear operator that responds equally to edges in any orientation (this is only approximate in the discrete case).</li>
<li>It measures curvature. If the image contains a linear trend the derivative will be non-zero despite having no boundaries, while the Laplacian will be zero.</li>
<li>Edges can be located as the zero-crossings in the Laplacian output. However, this way of detecting edges is not very reliable.</li>
<li>Zero crossings of an image form closed contours.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="image-laplacian-7" class="slide level2 smaller">
<h2>Image Laplacian</h2>

<img data-src="img/derivatives/discretelaplacian1d.png" style="width:70.0%" class="r-stretch quarto-figure-center" id="fig-discretelaplacian1d"><p class="caption">
Figure&nbsp;28: Comparison between the output of a first-order derivative and the Laplacian of 1D signal. (a) Input signal. (b) Kernel <span class="math inline">\(d_1\)</span>. (c) Output of the derivative, that is, convolution of (a) and (b). (d) Discrete approximation of the Laplacian. (e) Output of convolving the signal (a) with the Laplacian kernel.
</p></section>
<section id="early-visual-system-model" class="slide level2">
<h2>Early Visual System Model</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Approximation of the visual system</strong></p>
</div>
<div class="callout-content">
<p>We can better approximate Campbell and Robson chart with</p>
<p><span id="eq-humanmodel"><span class="math display">\[
h = -\nabla^2 g  + \lambda g
\qquad(12)\]</span></span></p>
<p>The kernel <span class="math inline">\(h\)</span> is the approximate impulse response of the human visual system, <span class="math inline">\(\lambda\)</span> is a small constant that is equal to the DC gain of the visual filter (here <span class="math inline">\(\lambda = 2\)</span> and <span class="math inline">\(\sigma=5\)</span>).</p>
<div id="fig-EVS_sigma5_lambda2" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-EVS_sigma5_lambda2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/derivatives/EVS_sigma5_lambda2.png" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-EVS_sigma5_lambda2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;29: Kernel corresponding to <a href="#/eq-humanmodel" class="quarto-xref">Equation&nbsp;12</a> with <span class="math inline">\(\lambda = 2\)</span> and <span class="math inline">\(\sigma=5\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="early-visual-system-model-1" class="slide level2">
<h2>Early Visual System Model</h2>
<div id="fig-csfchart" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-csfchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-csfchart" style="flex-basis: 55.6%;justify-content: flex-start;">
<div id="fig-csfchart" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-csfchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/csf.jpg" id="fig-csfchart" style="width:100.0%" data-ref-parent="fig-csfchart">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-csfchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 44.4%;justify-content: center;">
<p><img data-src="img/derivatives/dft_radial_EVS.png"></p>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-csfchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;30: Campbell and Robson chart, and a radial section of the Fourier transform of <span class="math inline">\(h\)</span> from <a href="#/eq-humanmodel" class="quarto-xref">Equation&nbsp;12</a>.
</figcaption>
</figure>
</div>
</section>
<section id="early-visual-system-model-2" class="slide level2 smaller">
<h2>Early Visual System Model</h2>
<div id="fig-vasarely" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-vasarely-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-vasarely" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-vasarely-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-vasarely-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/vasarely_c.jpg" id="fig-vasarely-a" data-ref-parent="fig-vasarely" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-vasarely-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-vasarely" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-vasarely-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-vasarely-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/vasarely_d.jpg" id="fig-vasarely-b" data-ref-parent="fig-vasarely" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-vasarely-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-vasarely" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-vasarely-c" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-vasarely-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/vasarely_section.png" id="fig-vasarely-c" data-ref-parent="fig-vasarely" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-vasarely-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-vasarely" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-vasarely-d" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-vasarely-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/vasarely_a.jpg" id="fig-vasarely-d" data-ref-parent="fig-vasarely" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-vasarely-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-vasarely" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-vasarely-e" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-vasarely-e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/vasarely_b.jpg" id="fig-vasarely-e" data-ref-parent="fig-vasarely" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-vasarely-e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-vasarely" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-vasarely-f" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-vasarely-f-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/vasarely_section_b.png" id="fig-vasarely-f" data-ref-parent="fig-vasarely" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-vasarely-f-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vasarely-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;31: Vasarely visual illusion. Images (a) and (d), formed by nested-squares, appear as having bright diagonals in (a) and dark in (d). Images (b) and (e) show the output of the human model given by the filter from <a href="#/eq-humanmodel" class="quarto-xref">Equation&nbsp;12</a>. Plot (c) displays the intensity profiles of images (a) and (b) as horizontal sections, with image (a) represented in red and image (b) in blue. Similarly, Plot (f) represents the intensity profiles of images (d) and (e).
</figcaption>
</figure>
</div>
</section>
<section id="sharpening-filter" class="slide level2">
<h2>Sharpening Filter</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Definition</strong></p>
</div>
<div class="callout-content">
<p>Sharpening can be achieved by amplifying the amplitude of the high-spatial frequency content of the image. We start with twice the original image (sharp plus blurred parts), then subtract away the blurred components of the image:</p>
<p><span id="eq-sharpening"><span class="math display">\[
\text{sharpening filter} =
\begin{bmatrix}
  0 &amp; 0 &amp; 0 \\
  0 &amp; 2 &amp; 0\\
  0 &amp; 0 &amp; 0
\end{bmatrix}
-
\frac{1}{16}
\begin{bmatrix}
  1 &amp; 2 &amp; 1 \\
  2 &amp; 4 &amp; 2\\
  1 &amp; 2 &amp; 1
\end{bmatrix}
\qquad(13)\]</span></span></p>
<p>Note that the DC gain of this sharpening filter is 1.</p>
</div>
</div>
</div>
</section>
<section id="sharpening-filter-1" class="slide level2 smaller">
<h2>Sharpening Filter</h2>
<div id="fig-convExamps3" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-convExamps3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-convExamps3" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-convExamps3-a" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-convExamps3-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/boat_sharp.jpg" id="fig-convExamps3-a" data-ref-parent="fig-convExamps3" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-convExamps3-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-convExamps3" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-convExamps3-b" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-convExamps3-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/boat_sharp0.jpg" id="fig-convExamps3-b" data-ref-parent="fig-convExamps3" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-convExamps3-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-convExamps3" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-convExamps3-c" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-convExamps3-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/boat_sharp1.jpg" id="fig-convExamps3-c" data-ref-parent="fig-convExamps3" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-convExamps3-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-convExamps3" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-convExamps3-d" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-convExamps3-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/boat_sharp2.jpg" id="fig-convExamps3-d" data-ref-parent="fig-convExamps3" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-convExamps3-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-convExamps3" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-convExamps3-e" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-convExamps3-e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/boat_sharp3.jpg" id="fig-convExamps3-e" data-ref-parent="fig-convExamps3" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-convExamps3-e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-convExamps3" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-convExamps3-f" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-convExamps3-f-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="img/spatial_filters/boat_sharp4.jpg" id="fig-convExamps3-f" data-ref-parent="fig-convExamps3" height="180">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-convExamps3-f-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-convExamps3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32: Sharpening achieved by subtraction of blurred components. (a) Original image. (b) Sharpened once by filtering with kernel from <a href="#/eq-sharpening" class="quarto-xref">Equation&nbsp;13</a>. Each color channel is filtered independently. (c-f) The same filter is applied successively to the previous output. In the last image, the sharpening filter has been applied five times to the input image.
</figcaption>
</figure>
</div>
</section>
<section id="retinex" class="slide level2 smaller">
<h2>Retinex</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Retinex</strong></p>
</div>
<div class="callout-content">
<p>How do you tell gray from white? The amount of light that reaches the eye from a painted piece of paper is the result of two quantities:</p>
<ul>
<li>the amount of light reaching the piece of paper</li>
<li>the reflectance of the surface</li>
</ul>
</div>
</div>
</div>

<img data-src="img/statistical_image_models/retinex.jpg" style="width:100.0%" class="r-stretch quarto-figure-center" id="fig-simultaneous"><p class="caption">
Figure&nbsp;33: Simultaneous contrast illusion. What happens if we see two patches of unknown reflectance, and each is illuminated with two different light sources of unknown identity?
</p></section>
<section id="retinex-2" class="slide level2">
<h2>Retinex</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Image formation</strong></p>
</div>
<div class="callout-content">
<p>Let’s think of the image formation process. The surface is made of patches of different reflectances <span class="math inline">\(r(x,y) \in (0,1)\)</span>. Each location receives an illumination <span class="math inline">\(l(x,y)\)</span>. The observed brightness is the product:</p>
<p><span class="math display">\[
\ell(x,y) = r(x,y) \times l(x,y)
\]</span></p>
<p>Despite what reaches the eye is the signal <span class="math inline">\(\ell(x,y)\)</span>, our perception is not the value of <span class="math inline">\(\ell(x,y)\)</span>. In fact, the squares 1 and 2 in <a href="#/fig-simultaneous" class="quarto-xref">Figure&nbsp;33</a> have the exact same values of intensity, but we see them differently, which is generally explained by saying that we discount (at least partially) the effects of the illumination, <span class="math inline">\(l(x,y)\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="retinex-3" class="slide level2">
<h2>Retinex</h2>

<img data-src="img/spatial_filters/mondrian.png" style="width:100.0%" class="r-stretch quarto-figure-center"><p class="caption">The Retinex algorithm, by Land and McCann <span class="citation" data-cites="Land1971">[@Land1971]</span>, is based on modeling images as if they were part of a Mondrian world (images that look like the paintings of Piet Mondrian).</p></section>
<section id="retinex-4" class="slide level2">
<h2>Retinex</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Algorithm</strong></p>
</div>
<div class="callout-content">
<p>But how can we estimate <span class="math inline">\(r(x,y)\)</span> and <span class="math inline">\(l(x,y)\)</span> by only observing <span class="math inline">\(\ell(x,y)\)</span>?</p>
<!-- Retinex: it is possible to extract $r$ and $l$ from $\ell$ if one takes into account some constraints about the expected nature of the images $r$ and $l$. -->
<p>The Retinex algorithm works by first extracting <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> spatial derivatives of the image <span class="math inline">\(\ell(x,y)\)</span> and then thresholding the gradients.</p>
<ol type="1">
<li>First, we transform the product into a sum using the <span class="math inline">\(\log\)</span>:</li>
</ol>
<p><span class="math display">\[
\log \ell(x,y) = \log r(x,y) + \log l(x,y)
\]</span></p>
<ol start="2" type="1">
<li>Taking derivatives along <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> is now simple:</li>
</ol>
<p><span class="math display">\[
\frac{\partial \log \ell(x,y)}{\partial x} = \frac{\partial \log r(x,y)}{\partial x} + \frac{\partial \log l(x,y)}{\partial x}
\]</span> And the same thing is done for the derivative along <span class="math inline">\(y\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="retinex-5" class="slide level2">
<h2>Retinex</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Algorithm</strong></p>
</div>
<div class="callout-content">
<ol start="3" type="1">
<li>Any derivative larger than the threshold is assigned to the derivative of the reflectance image <span class="math inline">\(r(x,y)\)</span>, and the ones smaller than a threshold are assigned to the illumination image <span class="math inline">\(l(x,y)\)</span>:</li>
</ol>
<p><span class="math display">\[
\frac{\partial \log r(x,y)}{\partial x} =  \begin{cases}
\frac{\partial \log \ell(x,y)}{\partial x} &amp; \text{if} ~  \left| \frac{\partial \log \ell(x,y)}{\partial x} \right|&gt;T\\
0 &amp; \text{otherwise}
\end{cases}
\]</span></p>
<ol start="4" type="1">
<li>Then, the image <span class="math inline">\(\log r(x,y)\)</span> is obtained by integrating the gradients, and exponentiating the result. Finally, the illumination can be obtained as <span class="math inline">\(l(x,y) = \ell(x,y)/r(x,y)\)</span>.</li>
</ol>
</div>
</div>
</div>
</section>
<section id="retinex-6" class="slide level2">
<h2>Retinex</h2>

<img data-src="img/statistical_image_models/retinex_solution_b.png" style="width:100.0%" class="r-stretch quarto-figure-center" id="fig-simultaneous2"><p class="caption">
Figure&nbsp;34: Derivatives classified into reflectance or luminance components.
</p></section>
<section id="retinex-7" class="slide level2">
<h2>Retinex</h2>

<img data-src="img/statistical_image_models/retinex_solution_a.png" style="width:100.0%" class="r-stretch quarto-figure-center" id="fig-simultaneous3"><p class="caption">
Figure&nbsp;35: Recovered components. The estimated reflectance, <span class="math inline">\(r(x,y)\)</span>, is close to what we perceive. It seems that what we perceive contains part of <span class="math inline">\(l(x,y)\)</span>.
</p></section>
<section id="retinex-8" class="slide level2">
<h2>Retinex</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Assumptions</strong></p>
</div>
<div class="callout-content">
<ul>
<li>the illumination image, <span class="math inline">\(l(x,y)\)</span>, varies smoothly</li>
<li>the reflectance image, <span class="math inline">\(r(x,y)\)</span>, is composed of uniform regions separated by sharp boundaries</li>
</ul>
</div>
</div>
</div>

<aside><div>
<p>Decomposing an image into different physical causes is known as <strong>intrinsic images decomposition</strong>. The intrinsic image decomposition, proposed by Barrow and Tenenbaum, aims to recover intrinsic scene characteristics from images, such as occlusions, depth, surface normals, shading, reflectance, reflections, and so on.</p>
</div></aside></section>
<section id="concluding-remarks-1" class="slide level2">
<h2>Concluding Remarks</h2>
<p>In this chapter we have covered a very powerful image representation: image derivatives (first order, second order, and the Laplacian) and their discrete approximations. Despite the simplicity of this representation, we have seen that it can be used in a number of applications such as image inpaining, separation of illumination and reflectance, and it can be used to explain simple visual illusions. It is not surprising that similar filters like the ones we have seen in this chapter emerge in convolutional neural networks when trained to solve visual tasks.</p>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="site_libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'multiplex': {"url":"https://mplex.vitv.ly","secret":null,"id":"0eeddbfb642a8eb99f1980947a12ab30c31c6520ca4b825ef73a04eeaa411db9"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/dslnu\.github\.io\/compvision\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>